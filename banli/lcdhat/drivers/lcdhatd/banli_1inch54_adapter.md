# 斑梨电子1.54寸LCD驱动适配文档

## 屏幕技术规格

基于搜索结果，斑梨电子1.54寸LCD的技术规格如下：

### 基本参数
- **屏幕尺寸**：1.54英寸
- **分辨率**：240×240像素
- **控制器**：ST7789V
- **接口类型**：SPI接口
- **色彩深度**：16位RGB565格式
- **屏幕类型**：IPS LCD高清显示

### ST7789控制器特性
- 支持240×240、240×320等分辨率
- 262K色（18位接口）/65K色（16位接口）
- 低功耗设计
- 高刷新率

## 驱动适配实现

### 1. 头文件配置 (`banli_1inch54.h`)
- 定义了ST7789控制器的所有寄存器命令
- 配置了屏幕分辨率和色彩格式
- 提供了专用的初始化序列

### 2. 驱动修改 (`lcdhatd.c`)

#### 初始化函数适配
```c
#ifdef BANLI_1INCH54_LCD
// 斑梨电子1.54寸LCD专用初始化序列
LCD_SendCommand(ST7789_SWRESET);    // 软件复位
usleep(120 * 1000);

LCD_SendCommand(ST7789_SLPOUT);     // 睡眠模式退出
usleep(120 * 1000);

LCD_SendCommand(ST7789_COLMOD);     // 像素格式设置
LCD_SendData_8Bit(0x55);            // RGB565格式

LCD_SendCommand(ST7789_MADCTL);     // 内存访问控制
LCD_SendData_8Bit(0x00);

LCD_SendCommand(ST7789_INVOFF);     // 显示反转关闭
LCD_SendCommand(ST7789_NORON);      // 正常显示模式
usleep(10 * 1000);

LCD_SendCommand(ST7789_DISPON);     // 显示开启
usleep(120 * 1000);
#endif
```

#### 分辨率配置
```c
#ifdef BANLI_1INCH54_LCD
// 斑梨电子1.54寸LCD固定分辨率
LCD.WIDTH = BANLI_LCD_WIDTH;    // 240
LCD.HEIGHT = BANLI_LCD_HEIGHT;  // 240
LCD.ROT = attr->ROT;
#endif
```

## 引脚配置建议

根据ST7789驱动经验，建议的GPIO引脚配置：

| 引脚功能 | GPIO引脚 | 说明 |
|---------|---------|------|
| TFT_CS  | GPIO5   | 片选信号 |
| TFT_DC  | GPIO15  | 数据/命令选择 |
| TFT_RST | GPIO16  | 复位信号 |
| TFT_SCK | GPIO11  | SPI时钟 |
| TFT_MOSI| GPIO10  | SPI数据输出 |
| TFT_BL  | GPIO18  | 背光控制 |

## 使用说明

### 1. 启用斑梨电子1.54寸LCD支持
在编译时添加宏定义：
```bash
-DBANLI_1INCH54_LCD
```

### 2. 配置屏幕参数
在系统配置中设置：
- 分辨率：240×240
- 色彩格式：RGB565
- 旋转方向：根据实际安装方向配置

### 3. 测试验证
建议的测试步骤：
1. 连接硬件并确保电源正常
2. 加载驱动模块
3. 检查/dev/fb0设备是否存在
4. 使用简单的图形测试程序验证显示功能

## 注意事项

1. **电源要求**：确保提供稳定的3.3V电源
2. **SPI时钟**：建议SPI时钟频率不超过40MHz
3. **背光控制**：背光引脚需要PWM控制以实现亮度调节
4. **时序要求**：严格遵守初始化序列中的延迟时间

## 故障排除

### 常见问题及解决方案

1. **屏幕无显示**
   - 检查电源连接
   - 验证SPI通信是否正常
   - 检查复位信号是否正确

2. **显示花屏**
   - 检查色彩格式配置
   - 验证内存访问控制寄存器设置
   - 检查SPI数据传输时序

3. **显示偏移**
   - 调整显示窗口设置
   - 检查扫描方向配置

## 性能优化建议

1. 使用DMA传输提高SPI数据传输效率
2. 实现双缓冲机制减少屏幕闪烁
3. 优化图形绘制算法提高刷新率

## 参考资料

- ST7789数据手册
- 斑梨电子官方技术文档
- Raspberry Pi GPIO引脚定义
- Linux帧缓冲设备驱动开发指南